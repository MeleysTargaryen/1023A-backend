<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque de Sapatos</title>
    <style>
             body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #333;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1.5rem;
      gap: 0.5rem;
    }

    label {
      font-weight: bold;
    }

    input {
      width: 100%;
      max-width: 300px;
      padding: 0.4rem;
      margin-bottom: 0.5rem;
      box-sizing: border-box;
    }

    button {
      padding: 0.4rem 1rem;
    }

    ul {
      list-style: disc;
      padding-left: 2rem;
      max-width: 600px;
    }

    .erro {
      color: red;
      font-weight: bold;
      margin-top: 1rem;
    }

    @media (max-width: 600px) {
      body {
        margin: 1rem;
      }
      input, button {
        width: 100%;
        max-width: 100%;
      }
    }
    </style>
</head>
<body>
    <h1>Estoque de Sapatos</h1>
    <form id="formBusca">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" placeholder="Digite o nome">
        <label for="marca">Marca:</label>
        <input type="text" id="marca" name="marca" placeholder="Digite a marca">
        <label for="tamanho">Tamanho:</label>
        <input type="number" id="tamanho" name="tamanho" placeholder="Digite o tamanho">
        <button type="submit">Buscar Estoque</button>
    </form>
    <ul id="minhalista"></ul>
    <div id="erro" class="erro"></div>
    <script>
        async function buscaDados(filtros) {
            let url = "http://localhost:8000/estoque_sapatos";
            const params = [];
            if (filtros.nome) params.push(`nome=${encodeURIComponent(filtros.nome)}`);
            if (filtros.marca) params.push(`marca=${encodeURIComponent(filtros.marca)}`);
            if (filtros.tamanho) params.push(`tamanho=${encodeURIComponent(filtros.tamanho)}`);
            if (params.length > 0) url += "?" + params.join("&");

            try {
                const resposta = await fetch(url);
                if (resposta.status === 200) {
                    const dados = await resposta.json();
                    const ul = document.getElementById("minhalista");
                    ul.innerHTML = "";
                    if (dados.length === 0) {
                        ul.innerHTML = "<li>Nenhum sapato encontrado.</li>";
                    } else {
                        dados.forEach(element => {
                            const novoli = document.createElement("li");
                            novoli.innerText = 
                                `Nome: ${element.nome || '-'} | Marca: ${element.marca || '-'} | Tamanho: ${element.tamanho || '-'}`;
                            ul.appendChild(novoli);
                        });
                    }
                    document.getElementById("erro").innerText = "";
                } else if (resposta.status === 400) {
                    const dados = await resposta.json();
                    document.getElementById("erro").innerText = dados.mensagem || "Erro desconhecido.";
                } else {
                    document.getElementById("erro").innerText = "ERRO N√ÉO IDENTIFICADO";
                }
            } catch (e) {
                document.getElementById("erro").innerText = "Erro ao conectar ao servidor.";
            }
        }

        document.getElementById("formBusca").addEventListener("submit", function(e) {
            e.preventDefault();
            const nome = document.getElementById("nome").value.trim();
            const marca = document.getElementById("marca").value.trim();
            const tamanho = document.getElementById("tamanho").value.trim();
            buscaDados({ nome, marca, tamanho });
        });
    </script>
</body>
</html>